"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = BottomWidgetFactory;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireDefault(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _timeWidget = _interopRequireDefault(require("./filters/time-widget"));

var _animationControl = _interopRequireDefault(require("./common/animation-control/animation-control"));

var _defaultSettings = require("../constants/default-settings");

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  padding-top: ", "px;\n  padding-right: ", "px;\n  padding-bottom: ", "px;\n  padding-left: ", "px;\n  width: ", "px;\n  bottom: 0;\n  right: 0;\n  z-index: 1;\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var propTypes = {
  filters: _propTypes["default"].arrayOf(_propTypes["default"].object),
  datasets: _propTypes["default"].object,
  uiState: _propTypes["default"].object,
  layers: _propTypes["default"].arrayOf(_propTypes["default"].object),
  animationConfig: _propTypes["default"].object,
  visStateActions: _propTypes["default"].object,
  sidePanelWidth: _propTypes["default"].number,
  containerW: _propTypes["default"].number
};
var maxWidth = 1080;
BottomWidgetFactory.deps = [_timeWidget["default"], _animationControl["default"]];

var BottomWidgetContainer = _styledComponents["default"].div(_templateObject(), function (props) {
  return props.theme.bottomWidgetPaddingTop;
}, function (props) {
  return props.theme.bottomWidgetPaddingRight;
}, function (props) {
  return props.theme.bottomWidgetPaddingBottom;
}, function (props) {
  return props.theme.bottomWidgetPaddingLeft;
}, function (props) {
  return props.width;
});

function BottomWidgetFactory(TimeWidget, AnimationControl) {
  var BottomWidget = function BottomWidget(props) {
    var datasets = props.datasets,
        filters = props.filters,
        animationConfig = props.animationConfig,
        visStateActions = props.visStateActions,
        containerW = props.containerW,
        uiState = props.uiState,
        sidePanelWidth = props.sidePanelWidth,
        layers = props.layers;
    var activeSidePanel = uiState.activeSidePanel,
        readOnly = uiState.readOnly;
    var isOpen = Boolean(activeSidePanel);
    var enlargedFilterIdx = filters.findIndex(function (f) {
      return f.enlarged && f.type === _defaultSettings.FILTER_TYPES.timeRange;
    });
    var isAnyFilterAnimating = filters.some(function (f) {
      return f.isAnimating;
    });
    var enlargedFilterWidth = isOpen ? containerW - sidePanelWidth : containerW; // show playback control if layers contain trip layer & at least one trip layer is visible

    var animatedLayer = layers.filter(function (l) {
      return l.config.animation && l.config.animation.enabled && l.config.isVisible;
    });
    var readToAnimation = Array.isArray(animationConfig.domain) && animationConfig.currentTime; // if animation control is showing, hide time display in time slider

    var showFloatingTimeDisplay = !animatedLayer.length;
    return _react["default"].createElement(BottomWidgetContainer, {
      width: Math.min(maxWidth, enlargedFilterWidth),
      className: "bottom-widget--container"
    }, animatedLayer.length && readToAnimation ? _react["default"].createElement(AnimationControl, {
      animationConfig: animationConfig,
      updateAnimationTime: visStateActions.updateAnimationTime,
      updateAnimationSpeed: visStateActions.updateLayerAnimationSpeed
    }) : null, enlargedFilterIdx > -1 && Object.keys(datasets).length > 0 ? _react["default"].createElement(TimeWidget, {
      filter: filters[enlargedFilterIdx],
      index: enlargedFilterIdx,
      isAnyFilterAnimating: isAnyFilterAnimating,
      datasets: datasets,
      readOnly: readOnly,
      showTimeDisplay: showFloatingTimeDisplay,
      setFilterPlot: visStateActions.setFilterPlot,
      setFilter: visStateActions.setFilter,
      toggleAnimation: visStateActions.toggleFilterAnimation,
      updateAnimationSpeed: visStateActions.updateFilterAnimationSpeed,
      enlargeFilter: visStateActions.enlargeFilter
    }) : null);
  };

  BottomWidget.propTypes = propTypes;
  return BottomWidget;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL2JvdHRvbS13aWRnZXQuanMiXSwibmFtZXMiOlsicHJvcFR5cGVzIiwiZmlsdGVycyIsIlByb3BUeXBlcyIsImFycmF5T2YiLCJvYmplY3QiLCJkYXRhc2V0cyIsInVpU3RhdGUiLCJsYXllcnMiLCJhbmltYXRpb25Db25maWciLCJ2aXNTdGF0ZUFjdGlvbnMiLCJzaWRlUGFuZWxXaWR0aCIsIm51bWJlciIsImNvbnRhaW5lclciLCJtYXhXaWR0aCIsIkJvdHRvbVdpZGdldEZhY3RvcnkiLCJkZXBzIiwiVGltZVdpZGdldEZhY3RvcnkiLCJBbmltYXRpb25Db250cm9sRmFjdG9yeSIsIkJvdHRvbVdpZGdldENvbnRhaW5lciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJib3R0b21XaWRnZXRQYWRkaW5nVG9wIiwiYm90dG9tV2lkZ2V0UGFkZGluZ1JpZ2h0IiwiYm90dG9tV2lkZ2V0UGFkZGluZ0JvdHRvbSIsImJvdHRvbVdpZGdldFBhZGRpbmdMZWZ0Iiwid2lkdGgiLCJUaW1lV2lkZ2V0IiwiQW5pbWF0aW9uQ29udHJvbCIsIkJvdHRvbVdpZGdldCIsImFjdGl2ZVNpZGVQYW5lbCIsInJlYWRPbmx5IiwiaXNPcGVuIiwiQm9vbGVhbiIsImVubGFyZ2VkRmlsdGVySWR4IiwiZmluZEluZGV4IiwiZiIsImVubGFyZ2VkIiwidHlwZSIsIkZJTFRFUl9UWVBFUyIsInRpbWVSYW5nZSIsImlzQW55RmlsdGVyQW5pbWF0aW5nIiwic29tZSIsImlzQW5pbWF0aW5nIiwiZW5sYXJnZWRGaWx0ZXJXaWR0aCIsImFuaW1hdGVkTGF5ZXIiLCJmaWx0ZXIiLCJsIiwiY29uZmlnIiwiYW5pbWF0aW9uIiwiZW5hYmxlZCIsImlzVmlzaWJsZSIsInJlYWRUb0FuaW1hdGlvbiIsIkFycmF5IiwiaXNBcnJheSIsImRvbWFpbiIsImN1cnJlbnRUaW1lIiwic2hvd0Zsb2F0aW5nVGltZURpc3BsYXkiLCJsZW5ndGgiLCJNYXRoIiwibWluIiwidXBkYXRlQW5pbWF0aW9uVGltZSIsInVwZGF0ZUxheWVyQW5pbWF0aW9uU3BlZWQiLCJPYmplY3QiLCJrZXlzIiwic2V0RmlsdGVyUGxvdCIsInNldEZpbHRlciIsInRvZ2dsZUZpbHRlckFuaW1hdGlvbiIsInVwZGF0ZUZpbHRlckFuaW1hdGlvblNwZWVkIiwiZW5sYXJnZUZpbHRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFNBQVMsR0FBRztBQUNoQkMsRUFBQUEsT0FBTyxFQUFFQyxzQkFBVUMsT0FBVixDQUFrQkQsc0JBQVVFLE1BQTVCLENBRE87QUFFaEJDLEVBQUFBLFFBQVEsRUFBRUgsc0JBQVVFLE1BRko7QUFHaEJFLEVBQUFBLE9BQU8sRUFBRUosc0JBQVVFLE1BSEg7QUFJaEJHLEVBQUFBLE1BQU0sRUFBRUwsc0JBQVVDLE9BQVYsQ0FBa0JELHNCQUFVRSxNQUE1QixDQUpRO0FBS2hCSSxFQUFBQSxlQUFlLEVBQUVOLHNCQUFVRSxNQUxYO0FBTWhCSyxFQUFBQSxlQUFlLEVBQUVQLHNCQUFVRSxNQU5YO0FBT2hCTSxFQUFBQSxjQUFjLEVBQUVSLHNCQUFVUyxNQVBWO0FBUWhCQyxFQUFBQSxVQUFVLEVBQUVWLHNCQUFVUztBQVJOLENBQWxCO0FBV0EsSUFBTUUsUUFBUSxHQUFHLElBQWpCO0FBRUFDLG1CQUFtQixDQUFDQyxJQUFwQixHQUEyQixDQUFDQyxzQkFBRCxFQUFvQkMsNEJBQXBCLENBQTNCOztBQUVBLElBQU1DLHFCQUFxQixHQUFHQyw2QkFBT0MsR0FBVixvQkFJVixVQUFBQyxLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFOLENBQVlDLHNCQUFoQjtBQUFBLENBSkssRUFLUixVQUFBRixLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFOLENBQVlFLHdCQUFoQjtBQUFBLENBTEcsRUFNUCxVQUFBSCxLQUFLO0FBQUEsU0FBSUEsS0FBSyxD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QXpELEdBQ0MsZ0NBQUMsVUFBRDtBQUNFLE1BQUEsTUFBTSxFQUFFMUQsT0FBTyxDQUFDa0MsaUJBQUQsQ0FEakI7QUFFRSxNQUFBLEtBQUssRUFBRUEsaUJBRlQ7QUFHRSxNQUFBLG9CQUFvQixFQUFFTyxvQkFIeEI7QUFJRSxNQUFBLFFBQVEsRUFBRXJDLFFBSlo7QUFLRSxNQUFBLFFBQVEsRUFBRTJCLFFBTFo7QUFNRSxNQUFBLGVBQWUsRUFBRTBCLHVCQU5uQjtBQU9FLE1BQUEsYUFBYSxFQUFFakQsZUFBZSxDQUFDeUQsYUFQakM7QUFRRSxNQUFBLFNBQVMsRUFBRXpELGVBQWUsQ0FBQzBELFNBUjdCO0FBU0UsTUFBQSxlQUFlLEVBQUUxRCxlQUFlLENBQUMyRCxxQkFUbkM7QUFVRSxNQUFBLG9CQUFvQixFQUFFM0QsZUFBZSxDQUFDNEQsMEJBVnhDO0FBV0UsTUFBQSxhQUFhLEVBQUU1RCxlQUFlLENBQUM2RDtBQVhqQyxNQURELEdBY0csSUF6Qk4sQ0FERjtBQTZCRCxHQTFERDs7QUE0REF4QyxFQUFBQSxZQUFZLENBQUM5QixTQUFiLEdBQXlCQSxTQUF6QjtBQUVBLFNBQU84QixZQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjAgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFRpbWVXaWRnZXRGYWN0b3J5IGZyb20gJy4vZmlsdGVycy90aW1lLXdpZGdldCc7XG5pbXBvcnQgQW5pbWF0aW9uQ29udHJvbEZhY3RvcnkgZnJvbSAnLi9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvYW5pbWF0aW9uLWNvbnRyb2wnO1xuaW1wb3J0IHtGSUxURVJfVFlQRVN9IGZyb20gJ2NvbnN0YW50cy9kZWZhdWx0LXNldHRpbmdzJztcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICBmaWx0ZXJzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMub2JqZWN0KSxcbiAgZGF0YXNldHM6IFByb3BUeXBlcy5vYmplY3QsXG4gIHVpU3RhdGU6IFByb3BUeXBlcy5vYmplY3QsXG4gIGxheWVyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCksXG4gIGFuaW1hdGlvbkNvbmZpZzogUHJvcFR5cGVzLm9iamVjdCxcbiAgdmlzU3RhdGVBY3Rpb25zOiBQcm9wVHlwZXMub2JqZWN0LFxuICBzaWRlUGFuZWxXaWR0aDogUHJvcFR5cGVzLm51bWJlcixcbiAgY29udGFpbmVyVzogUHJvcFR5cGVzLm51bWJlclxufTtcblxuY29uc3QgbWF4V2lkdGggPSAxMDgwO1xuXG5Cb3R0b21XaWRnZXRGYWN0b3J5LmRlcHMgPSBbVGltZVdpZGdldEZhY3RvcnksIEFuaW1hdGlvbkNvbnRyb2xGYWN0b3J5XTtcblxuY29uc3QgQm90dG9tV2lkZ2V0Q29udGFpbmVyID0gc3R5bGVkLmRpdmBcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICBwYWRkaW5nLXRvcDogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5ib3R0b21XaWRnZXRQYWRkaW5nVG9wfXB4O1xuICBwYWRkaW5nLXJpZ2h0OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmJvdHRvbVdpZGdldFBhZGRpbmdSaWdodH1weDtcbiAgcGFkZGluZy1ib3R0b206ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuYm90dG9tV2lkZ2V0UGFkZGluZ0JvdHRvbX1weDtcbiAgcGFkZGluZy1sZWZ0OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmJvdHRvbVdpZGdldFBhZGRpbmdMZWZ0fXB4O1xuICB3aWR0aDogJHtwcm9wcyA9PiBwcm9wcy53aWR0aH1weDtcbiAgYm90dG9tOiAwO1xuICByaWdodDogMDtcbiAgei1pbmRleDogMTtcbmA7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEJvdHRvbVdpZGdldEZhY3RvcnkoVGltZVdpZGdldCwgQW5pbWF0aW9uQ29udHJvbCkge1xuICBjb25zdCBCb3R0b21XaWRnZXQgPSBwcm9wcyA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgZGF0YXNldHMsXG4gICAgICBmaWx0ZXJzLFxuICAgICAgYW5pbWF0aW9uQ29uZmlnLFxuICAgICAgdmlzU3RhdGVBY3Rpb25zLFxuICAgICAgY29udGFpbmVyVyxcbiAgICAgIHVpU3RhdGUsXG4gICAgICBzaWRlUGFuZWxXaWR0aCxcbiAgICAgIGxheWVyc1xuICAgIH0gPSBwcm9wcztcblxuICAgIGNvbnN0IHthY3RpdmVTaWRlUGFuZWwsIHJlYWRPbmx5fSA9IHVpU3RhdGU7XG4gICAgY29uc3QgaXNPcGVuID0gQm9vbGVhbihhY3RpdmVTaWRlUGFuZWwpO1xuXG4gICAgY29uc3QgZW5sYXJnZWRGaWx0ZXJJZHggPSBmaWx0ZXJzLmZpbmRJbmRleChcbiAgICAgIGYgPT4gZi5lbmxhcmdlZCAmJiBmLnR5cGUgPT09IEZJTFRFUl9UWVBFUy50aW1lUmFuZ2VcbiAgICApO1xuICAgIGNvbnN0IGlzQW55RmlsdGVyQW5pbWF0aW5nID0gZmlsdGVycy5zb21lKGYgPT4gZi5pc0FuaW1hdGluZyk7XG4gICAgY29uc3QgZW5sYXJnZWRGaWx0ZXJXaWR0aCA9IGlzT3BlbiA/IGNvbnRhaW5lclcgLSBzaWRlUGFuZWxXaWR0aCA6IGNvbnRhaW5lclc7XG5cbiAgICAvLyBzaG93IHBsYXliYWNrIGNvbnRyb2wgaWYgbGF5ZXJzIGNvbnRhaW4gdHJpcCBsYXllciAmIGF0IGxlYXN0IG9uZSB0cmlwIGxheWVyIGlzIHZpc2libGVcbiAgICBjb25zdCBhbmltYXRlZExheWVyID0gbGF5ZXJzLmZpbHRlcihcbiAgICAgIGwgPT4gbC5jb25maWcuYW5pbWF0aW9uICYmIGwuY29uZmlnLmFuaW1hdGlvbi5lbmFibGVkICYmIGwuY29uZmlnLmlzVmlzaWJsZVxuICAgICk7XG5cbiAgICBjb25zdCByZWFkVG9BbmltYXRpb24gPSBBcnJheS5pc0FycmF5KGFuaW1hdGlvbkNvbmZpZy5kb21haW4pICYmIGFuaW1hdGlvbkNvbmZpZy5jdXJyZW50VGltZTtcbiAgICAvLyBpZiBhbmltYXRpb24gY29udHJvbCBpcyBzaG93aW5nLCBoaWRlIHRpbWUgZGlzcGxheSBpbiB0aW1lIHNsaWRlclxuICAgIGNvbnN0IHNob3dGbG9hdGluZ1RpbWVEaXNwbGF5ID0gIWFuaW1hdGVkTGF5ZXIubGVuZ3RoO1xuICAgIHJldHVybiAoXG4gICAgICA8Qm90dG9tV2lkZ2V0Q29udGFpbmVyXG4gICAgICAgIHdpZHRoPXtNYXRoLm1pbihtYXhXaWR0aCwgZW5sYXJnZWRGaWx0ZXJXaWR0aCl9XG4gICAgICAgIGNsYXNzTmFtZT1cImJvdHRvbS13aWRnZXQtLWNvbnRhaW5lclwiXG4gICAgICA+XG4gICAgICAgIHthbmltYXRlZExheWVyLmxlbmd0aCAmJiByZWFkVG9BbmltYXRpb24gPyAoXG4gICAgICAgICAgPEFuaW1hdGlvbkNvbnRyb2xcbiAgICAgICAgICAgIGFuaW1hdGlvbkNvbmZpZz17YW5pbWF0aW9uQ29uZmlnfVxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uVGltZT17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUFuaW1hdGlvblRpbWV9XG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUxheWVyQW5pbWF0aW9uU3BlZWR9XG4gICAgICAgICAgLz5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICAgIHtlbmxhcmdlZEZpbHRlcklkeCA+IC0xICYmIE9iamVjdC5rZXlzKGRhdGFzZXRzKS5sZW5ndGggPiAwID8gKFxuICAgICAgICAgIDxUaW1lV2lkZ2V0XG4gICAgICAgICAgICBmaWx0ZXI9e2ZpbHRlcnNbZW5sYXJnZWRGaWx0ZXJJZHhdfVxuICAgICAgICAgICAgaW5kZXg9e2VubGFyZ2VkRmlsdGVySWR4fVxuICAgICAgICAgICAgaXNBbnlGaWx0ZXJBbmltYXRpbmc9e2lzQW55RmlsdGVyQW5pbWF0aW5nfVxuICAgICAgICAgICAgZGF0YXNldHM9e2RhdGFzZXRzfVxuICAgICAgICAgICAgcmVhZE9ubHk9e3JlYWRPbmx5fVxuICAgICAgICAgICAgc2hvd1RpbWVEaXNwbGF5PXtzaG93RmxvYXRpbmdUaW1lRGlzcGxheX1cbiAgICAgICAgICAgIHNldEZpbHRlclBsb3Q9e3Zpc1N0YXRlQWN0aW9ucy5zZXRGaWx0ZXJQbG90fVxuICAgICAgICAgICAgc2V0RmlsdGVyPXt2aXNTdGF0ZUFjdGlvbnMuc2V0RmlsdGVyfVxuICAgICAgICAgICAgdG9nZ2xlQW5pbWF0aW9uPXt2aXNTdGF0ZUFjdGlvbnMudG9nZ2xlRmlsdGVyQW5pbWF0aW9ufVxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQ9e3Zpc1N0YXRlQWN0aW9ucy51cGRhdGVGaWx0ZXJBbmltYXRpb25TcGVlZH1cbiAgICAgICAgICAgIGVubGFyZ2VGaWx0ZXI9e3Zpc1N0YXRlQWN0aW9ucy5lbmxhcmdlRmlsdGVyfVxuICAgICAgICAgIC8+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC9Cb3R0b21XaWRnZXRDb250YWluZXI+XG4gICAgKTtcbiAgfTtcblxuICBCb3R0b21XaWRnZXQucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuXG4gIHJldHVybiBCb3R0b21XaWRnZXQ7XG59XG4iXX0=